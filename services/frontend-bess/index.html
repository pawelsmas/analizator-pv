<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Magazyn Energii BESS</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="bess-container">
  <div class="page-header">
    <h1>MAGAZYN ENERGII BESS</h1>
    <div class="header-info">
      <span id="dataInfo">Brak danych BESS</span>
    </div>
  </div>

  <!-- Variant Selector -->
  <div class="variant-selector">
    <div class="selector-label">Wybierz wariant instalacji:</div>
    <div class="variant-buttons">
      <button class="variant-btn active" data-variant="A" onclick="selectVariant('A')">
        <span class="variant-name">Wariant A</span>
        <span class="variant-desc" id="descA">≈Åadowanie...</span>
      </button>
      <button class="variant-btn" data-variant="B" onclick="selectVariant('B')">
        <span class="variant-name">Wariant B</span>
        <span class="variant-desc" id="descB">≈Åadowanie...</span>
      </button>
      <button class="variant-btn" data-variant="C" onclick="selectVariant('C')">
        <span class="variant-name">Wariant C</span>
        <span class="variant-desc" id="descC">≈Åadowanie...</span>
      </button>
      <button class="variant-btn" data-variant="D" onclick="selectVariant('D')">
        <span class="variant-name">Wariant D</span>
        <span class="variant-desc" id="descD">≈Åadowanie...</span>
      </button>
    </div>
  </div>

  <!-- BESS Status Banner -->
  <div id="bessDisabledBanner" class="bess-disabled-banner" style="display:none;">
    <div class="banner-icon">‚ö†Ô∏è</div>
    <div class="banner-content">
      <h3>BESS wy≈ÇƒÖczony</h3>
      <p>Magazyn energii nie jest w≈ÇƒÖczony dla tego wariantu. Przejd≈∫ do <strong>USTAWIENIA</strong> aby w≈ÇƒÖczyƒá BESS.</p>
    </div>
  </div>

  <div id="bessContent" class="content-grid" style="display:none;">

    <!-- Main BESS Configuration Card -->
    <div class="bess-main-card full-width">
      <div class="bess-header">
        <div class="bess-icon-box">üîã</div>
        <div class="bess-title">
          <h2>Magazyn Energii BESS</h2>
          <div class="bess-subtitle">Tryb 0-Export ‚Ä¢ Automatyczny dob√≥r</div>
        </div>
        <div class="bess-config-badge">
          <div class="config-label">KONFIGURACJA</div>
          <div class="config-value" id="bessConfigMain">- kW / - kWh</div>
          <div class="config-duration" id="bessDurationMain">Duration: -h</div>
        </div>
      </div>
    </div>

    <!-- KPI Cards Row 1: Energy Metrics -->
    <div class="stats-section full-width">
      <h2>Metryki Energetyczne BESS</h2>
      <div class="stats-cards">
        <div class="stat-card bess-green">
          <div class="stat-icon">üìà</div>
          <div class="stat-content">
            <div class="stat-label">Wzrost Autokonsumpcji</div>
            <div class="stat-value" id="bessAutoIncrease">+0%</div>
            <div class="stat-detail" id="bessAutoCompare">- % ‚Üí - %</div>
          </div>
        </div>
        <div class="stat-card bess-purple">
          <div class="stat-icon">‚ö°</div>
          <div class="stat-content">
            <div class="stat-label">Energia z Baterii</div>
            <div class="stat-value" id="bessEnergyFromBattery">0</div>
            <div class="stat-unit">MWh/rok</div>
            <div class="stat-detail" id="bessCyclesInfo">0 cykli ekw./rok</div>
          </div>
        </div>
        <div class="stat-card bess-red">
          <div class="stat-icon">üö´</div>
          <div class="stat-content">
            <div class="stat-label">Curtailment (strata)</div>
            <div class="stat-value" id="bessCurtailmentTotal">0</div>
            <div class="stat-unit">MWh/rok</div>
            <div class="stat-detail" id="bessCurtailmentPct">0% produkcji PV</div>
          </div>
        </div>
        <div class="stat-card bess-blue">
          <div class="stat-icon">üîÑ</div>
          <div class="stat-content">
            <div class="stat-label">Cykle Ekwiwalentne</div>
            <div class="stat-value" id="bessCyclesYear">0</div>
            <div class="stat-unit">cykli/rok</div>
            <div class="stat-detail" id="bessCyclesLifetime">Lifetime: - cykli</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Energy Flow Section -->
    <div class="chart-section">
      <h2>Przep≈Çyw Energii BESS</h2>
      <div class="energy-flow-box">
        <div class="flow-item flow-charging">
          <span class="flow-icon">‚ñº</span>
          <span class="flow-label">≈Åadowanie</span>
          <span class="flow-value" id="bessToBattery">- MWh</span>
        </div>
        <div class="flow-item flow-discharging">
          <span class="flow-icon">‚ñ≤</span>
          <span class="flow-label">Roz≈Çadowanie</span>
          <span class="flow-value" id="bessFromBattery">- MWh</span>
        </div>
        <div class="flow-item flow-curtailed">
          <span class="flow-icon">‚úï</span>
          <span class="flow-label">Curtailment</span>
          <span class="flow-value" id="bessCurtailed">- MWh</span>
        </div>
        <div class="flow-item flow-efficiency">
          <span class="flow-icon">‚Üª</span>
          <span class="flow-label">Sprawno≈õƒá RT</span>
          <span class="flow-value" id="bessEfficiency">- %</span>
        </div>
      </div>
    </div>

    <!-- BESS Cycle Animation Section -->
    <div class="chart-section full-width bess-animation-section">
      <h2>üîÑ Animacja Cyklu BESS - Przep≈Çyw Energii w Czasie</h2>
      <div class="bess-animation-container">
        <!-- Visual Energy Flow Diagram -->
        <div class="bess-flow-diagram">
          <!-- PV Panel -->
          <div class="flow-node pv-node">
            <div class="node-icon">‚òÄÔ∏è</div>
            <div class="node-label">PV</div>
            <div class="node-value" id="animPvPower">0 kW</div>
          </div>

          <!-- Flow arrows container -->
          <div class="flow-arrows">
            <!-- PV to Battery -->
            <div class="flow-arrow arrow-pv-battery" id="arrowPvBattery">
              <div class="arrow-line">
                <div class="arrow-particles" id="particlesPvBattery"></div>
              </div>
              <div class="arrow-value" id="flowPvBattery">0</div>
            </div>

            <!-- PV to Load -->
            <div class="flow-arrow arrow-pv-load" id="arrowPvLoad">
              <div class="arrow-line">
                <div class="arrow-particles" id="particlesPvLoad"></div>
              </div>
              <div class="arrow-value" id="flowPvLoad">0</div>
            </div>

            <!-- Battery to Load -->
            <div class="flow-arrow arrow-battery-load" id="arrowBatteryLoad">
              <div class="arrow-line">
                <div class="arrow-particles" id="particlesBatteryLoad"></div>
              </div>
              <div class="arrow-value" id="flowBatteryLoad">0</div>
            </div>

            <!-- Grid to Load -->
            <div class="flow-arrow arrow-grid-load" id="arrowGridLoad">
              <div class="arrow-line">
                <div class="arrow-particles" id="particlesGridLoad"></div>
              </div>
              <div class="arrow-value" id="flowGridLoad">0</div>
            </div>

            <!-- Curtailment -->
            <div class="flow-arrow arrow-curtailment" id="arrowCurtailment">
              <div class="arrow-line">
                <div class="arrow-particles curtailment-particles" id="particlesCurtailment"></div>
              </div>
              <div class="arrow-value" id="flowCurtailment">0</div>
            </div>
          </div>

          <!-- Battery -->
          <div class="flow-node battery-node">
            <div class="battery-visual">
              <div class="battery-body">
                <div class="battery-fill" id="batteryFill"></div>
                <div class="battery-level" id="batteryLevel">0%</div>
              </div>
              <div class="battery-cap"></div>
            </div>
            <div class="node-label">BESS</div>
            <div class="node-value" id="animBatteryKwh">0 kWh</div>
          </div>

          <!-- Load -->
          <div class="flow-node load-node">
            <div class="node-icon">üè≠</div>
            <div class="node-label">Zu≈ºycie</div>
            <div class="node-value" id="animLoadPower">0 kW</div>
          </div>

          <!-- Grid -->
          <div class="flow-node grid-node">
            <div class="node-icon">‚ö°</div>
            <div class="node-label">Sieƒá</div>
            <div class="node-value" id="animGridPower">0 kW</div>
          </div>

          <!-- Curtailment indicator -->
          <div class="flow-node curtailment-node" id="curtailmentNode" style="display: none;">
            <div class="node-icon">üö´</div>
            <div class="node-label">Strata</div>
            <div class="node-value" id="animCurtailment">0 kW</div>
          </div>
        </div>

        <!-- Time Display and Stats -->
        <div class="bess-animation-stats">
          <div class="anim-time-display">
            <div class="anim-date" id="animDate">01 Stycze≈Ñ</div>
            <div class="anim-time" id="animTime">00:00</div>
            <div class="anim-daynight" id="animDayNight">üåô</div>
          </div>

          <div class="anim-stats-grid">
            <div class="anim-stat">
              <span class="anim-stat-label">Energia PV dzi≈õ:</span>
              <span class="anim-stat-value" id="animDailyPv">0 kWh</span>
            </div>
            <div class="anim-stat">
              <span class="anim-stat-label">Zu≈ºycie dzi≈õ:</span>
              <span class="anim-stat-value" id="animDailyLoad">0 kWh</span>
            </div>
            <div class="anim-stat">
              <span class="anim-stat-label">Z baterii dzi≈õ:</span>
              <span class="anim-stat-value" id="animDailyFromBess">0 kWh</span>
            </div>
            <div class="anim-stat">
              <span class="anim-stat-label">Cykle dzi≈õ:</span>
              <span class="anim-stat-value" id="animDailyCycles">0,0</span>
            </div>
          </div>

          <!-- Progress bar for the year -->
          <div class="anim-year-progress">
            <div class="progress-label">
              <span>Dzie≈Ñ roku:</span>
              <span id="animDayOfYear">1 / 365</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="animYearProgress"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Animation Controls -->
      <div class="bess-animation-controls">
        <button class="anim-btn anim-btn-nav" onclick="bessAnimJump('start')" title="PoczƒÖtek roku">‚èÆÔ∏è</button>
        <button class="anim-btn anim-btn-nav" onclick="bessAnimJump('prev-day')" title="Poprzedni dzie≈Ñ">‚è™</button>
        <button class="anim-btn anim-btn-play" id="bessAnimPlayBtn" onclick="toggleBessAnimation()">
          <span id="bessAnimPlayIcon">‚ñ∂Ô∏è</span>
          <span id="bessAnimPlayText">Start</span>
        </button>
        <button class="anim-btn anim-btn-nav" onclick="bessAnimJump('next-day')" title="Nastƒôpny dzie≈Ñ">‚è©</button>
        <button class="anim-btn anim-btn-nav" onclick="bessAnimJump('end')" title="Koniec roku">‚è≠Ô∏è</button>

        <div class="anim-speed-control">
          <label>Prƒôdko≈õƒá:</label>
          <select id="bessAnimSpeedSelect" onchange="updateBessAnimSpeed()">
            <option value="1000">1 godz/sek</option>
            <option value="500" selected>2 godz/sek</option>
            <option value="250">4 godz/sek</option>
            <option value="100">10 godz/sek</option>
            <option value="50">20 godz/sek</option>
          </select>
        </div>

        <button class="anim-btn anim-btn-secondary" onclick="resetBessAnimation()">üîÑ Reset</button>
      </div>

      <div class="info-banner" style="margin-top: 16px;">
        <div class="banner-icon">üí°</div>
        <div class="banner-text">
          Animacja pokazuje godzinowy przep≈Çyw energii przez ca≈Çy rok. ≈ª√≥≈Çte czƒÖsteczki = energia z PV,
          zielone = energia z/do baterii, czerwone = pob√≥r z sieci, szare = curtailment (strata).
        </div>
      </div>
    </div>

    <!-- NEW in v3.2: Monthly BESS Balance -->
    <div class="table-section full-width">
      <h2>Bilans Miesiƒôczny BESS</h2>
      <div class="chart-info">
        Szczeg√≥≈Çowy rozk≈Çad energii i cykli baterii w poszczeg√≥lnych miesiƒÖcach roku
      </div>
      <div class="table-wrapper">
        <table id="bessMonthlyTable" class="monthly-table">
          <thead>
            <tr>
              <th>MiesiƒÖc</th>
              <th>≈Åadowanie<br/><span class="unit">MWh</span></th>
              <th>Roz≈Çadowanie<br/><span class="unit">MWh</span></th>
              <th>Curtailment<br/><span class="unit">MWh</span></th>
              <th>Import z sieci<br/><span class="unit">MWh</span></th>
              <th>Cykle ekw.<br/><span class="unit">szt.</span></th>
              <th>Throughput<br/><span class="unit">MWh</span></th>
            </tr>
          </thead>
          <tbody id="bessMonthlyTableBody">
            <!-- Dynamically filled by JavaScript -->
          </tbody>
          <tfoot id="bessMonthlyTableFoot">
            <!-- Summary row -->
          </tfoot>
        </table>
      </div>
    </div>

    <!-- NEW in v3.2: Quarterly Cycles Summary -->
    <div class="stats-section full-width">
      <h2>Rozk≈Çad Cykli w Kwarta≈Çach</h2>
      <div class="stats-cards quarterly-cards">
        <div class="stat-card bess-q1">
          <div class="stat-icon">‚ùÑÔ∏è</div>
          <div class="stat-content">
            <div class="stat-label">Q1 (Sty-Mar)</div>
            <div class="stat-value" id="bessQ1Cycles">0</div>
            <div class="stat-unit">cykli</div>
            <div class="stat-detail" id="bessQ1Throughput">0 MWh</div>
          </div>
        </div>
        <div class="stat-card bess-q2">
          <div class="stat-icon">üå∏</div>
          <div class="stat-content">
            <div class="stat-label">Q2 (Kwi-Cze)</div>
            <div class="stat-value" id="bessQ2Cycles">0</div>
            <div class="stat-unit">cykli</div>
            <div class="stat-detail" id="bessQ2Throughput">0 MWh</div>
          </div>
        </div>
        <div class="stat-card bess-q3">
          <div class="stat-icon">‚òÄÔ∏è</div>
          <div class="stat-content">
            <div class="stat-label">Q3 (Lip-Wrz)</div>
            <div class="stat-value" id="bessQ3Cycles">0</div>
            <div class="stat-unit">cykli</div>
            <div class="stat-detail" id="bessQ3Throughput">0 MWh</div>
          </div>
        </div>
        <div class="stat-card bess-q4">
          <div class="stat-icon">üçÇ</div>
          <div class="stat-content">
            <div class="stat-label">Q4 (Pa≈∫-Gru)</div>
            <div class="stat-value" id="bessQ4Cycles">0</div>
            <div class="stat-unit">cykli</div>
            <div class="stat-detail" id="bessQ4Throughput">0 MWh</div>
          </div>
        </div>
      </div>
    </div>

    <!-- NEW in v3.2: SOC Histogram Chart -->
    <div class="chart-section">
      <h2>Histogram SOC (Stan Na≈Çadowania)</h2>
      <div class="chart-info">
        Rozk≈Çad czasu w poszczeg√≥lnych przedzia≈Çach SOC w ciƒÖgu roku (8760 godzin)
      </div>
      <div class="chart-wrapper">
        <canvas id="socHistogramChart"></canvas>
      </div>
    </div>

    <!-- NEW in v3.2: Monthly Curtailment Chart -->
    <div class="chart-section">
      <h2>Curtailment Miesiƒôcznie</h2>
      <div class="chart-info">
        Energia curtailowana (stracona) z powodu pe≈Çnej baterii w poszczeg√≥lnych miesiƒÖcach
      </div>
      <div class="chart-wrapper">
        <canvas id="curtailmentChart"></canvas>
      </div>
    </div>

    <!-- Comparison Table: PV+BESS vs Only PV -->
    <div class="chart-section">
      <h2>Por√≥wnanie: PV+BESS vs Tylko PV</h2>
      <div class="table-wrapper">
        <table class="comparison-table">
          <thead>
            <tr>
              <th>Parametr</th>
              <th>Tylko PV</th>
              <th>PV + BESS</th>
              <th>R√≥≈ºnica</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Autokonsumpcja</td>
              <td id="baselineAuto">-</td>
              <td id="bessAuto">-</td>
              <td id="diffAuto" class="diff-positive">-</td>
            </tr>
            <tr>
              <td>Zu≈ºycie w≈Çasne [MWh]</td>
              <td id="baselineSelfConsumed">-</td>
              <td id="bessSelfConsumed">-</td>
              <td id="diffSelfConsumed" class="diff-positive">-</td>
            </tr>
            <tr>
              <td>Eksport do sieci [MWh]</td>
              <td id="baselineExported">-</td>
              <td id="bessExported">-</td>
              <td id="diffExported" class="diff-negative">-</td>
            </tr>
            <tr class="highlight-row">
              <td>Pokrycie potrzeb</td>
              <td id="baselineCoverage">-</td>
              <td id="bessCoverage">-</td>
              <td id="diffCoverage" class="diff-positive">-</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- NEW in v3.2: Delta PV vs PV+BESS Economics -->
    <div class="stats-section full-width delta-section">
      <h2>Œî Delta: PV+BESS vs Tylko PV</h2>
      <div class="chart-info">
        Analiza dodatkowej op≈Çacalno≈õci BESS w por√≥wnaniu do instalacji tylko PV
      </div>
      <div class="stats-cards">
        <div class="stat-card bess-blue">
          <div class="stat-icon">üìà</div>
          <div class="stat-content">
            <div class="stat-label">Dodatkowe zu≈ºycie w≈Çasne</div>
            <div class="stat-value" id="deltaSelfConsumed">0</div>
            <div class="stat-unit">MWh/rok</div>
            <div class="stat-detail" id="deltaSelfConsumedInfo">z baterii (nie z sieci)</div>
          </div>
        </div>
        <div class="stat-card bess-green">
          <div class="stat-icon">üíµ</div>
          <div class="stat-content">
            <div class="stat-label">Œî Oszczƒôdno≈õci rocznie</div>
            <div class="stat-value" id="deltaSavings">0</div>
            <div class="stat-unit">tys. PLN/rok</div>
            <div class="stat-detail" id="deltaSavingsInfo">mniej zakupionej energii</div>
          </div>
        </div>
        <div class="stat-card bess-purple">
          <div class="stat-icon">‚è±Ô∏è</div>
          <div class="stat-content">
            <div class="stat-label">Prosty Payback BESS</div>
            <div class="stat-value" id="deltaPayback">-</div>
            <div class="stat-unit">lat</div>
            <div class="stat-detail" id="deltaPaybackInfo">CAPEX / Œî oszczƒôdno≈õci</div>
          </div>
        </div>
        <div class="stat-card bess-orange">
          <div class="stat-icon">üìä</div>
          <div class="stat-content">
            <div class="stat-label">ROI BESS</div>
            <div class="stat-value" id="deltaROI">-</div>
            <div class="stat-unit">%</div>
            <div class="stat-detail" id="deltaROIInfo">zwrot z inwestycji BESS</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Economic KPIs -->
    <div class="stats-section full-width">
      <h2>Ekonomia BESS</h2>
      <div class="stats-cards">
        <div class="stat-card bess-blue">
          <div class="stat-icon">üí∞</div>
          <div class="stat-content">
            <div class="stat-label">BESS CAPEX</div>
            <div class="stat-value" id="bessEconCapex">0</div>
            <div class="stat-unit">tys. PLN</div>
            <div class="stat-detail" id="bessEconCapexDetail">- PLN/kWh + - PLN/kW</div>
          </div>
        </div>
        <div class="stat-card bess-orange">
          <div class="stat-icon">üîß</div>
          <div class="stat-content">
            <div class="stat-label">BESS OPEX/rok</div>
            <div class="stat-value" id="bessEconOpex">0</div>
            <div class="stat-unit">tys. PLN</div>
            <div class="stat-detail" id="bessEconOpexPct">0% CAPEX/rok</div>
          </div>
        </div>
        <div class="stat-card bess-red">
          <div class="stat-icon">üîÑ</div>
          <div class="stat-content">
            <div class="stat-label">Wymiana baterii</div>
            <div class="stat-value" id="bessEconReplacement">-</div>
            <div class="stat-unit">rok</div>
            <div class="stat-detail" id="bessEconReplacementCost">Koszt: - tys. PLN</div>
          </div>
        </div>
        <div class="stat-card bess-green">
          <div class="stat-icon">‚ö°</div>
          <div class="stat-content">
            <div class="stat-label">Energia z BESS (≈ÇƒÖcznie)</div>
            <div class="stat-value" id="bessEconTotalEnergy">0</div>
            <div class="stat-unit">MWh</div>
            <div class="stat-detail" id="bessEconTotalEnergyPeriod">przez - lat</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Degradation Parameters Info -->
    <div class="info-banner full-width">
      <div class="banner-icon">üìâ</div>
      <div class="banner-text">
        <strong>Parametry degradacji:</strong>
        <span id="bessEconDegradationParams">Rok 1: -% | Lata 2+: -%/rok | ≈ªywotno≈õƒá: - lat</span>
      </div>
    </div>

    <!-- BESS Degradation Table -->
    <div class="table-section full-width">
      <h2>Energia z BESS w kolejnych latach (z uwzglƒôdnieniem degradacji)</h2>
      <div class="chart-info">
        Tabela pokazuje jak degradacja baterii wp≈Çywa na ilo≈õƒá energii dostarczanej przez BESS
      </div>
      <div class="table-wrapper">
        <table id="bessDegradationTable" class="degradation-table">
          <thead>
            <tr>
              <th>Rok</th>
              <th>Pojemno≈õƒá nominalna<br/><span class="unit">kWh</span></th>
              <th>Degradacja<br/><span class="unit">%</span></th>
              <th>Pojemno≈õƒá efektywna<br/><span class="unit">kWh</span></th>
              <th>Energia z BESS<br/><span class="unit">MWh/rok</span></th>
              <th>Energia skumulowana<br/><span class="unit">MWh</span></th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="bessDegradationTableBody">
            <!-- Dynamically filled -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- EOL Thresholds Info -->
    <div class="info-banner full-width bess-eol-info">
      <div class="banner-icon">‚ÑπÔ∏è</div>
      <div class="banner-text">
        <strong>Progi EOL:</strong>
        ‚úÖ OK: ‚â•85% pojemno≈õci nominalnej |
        ‚ö†Ô∏è Blisko EOL: 80-85% |
        üîÑ Wymiana: &lt;80% lub koniec ≈ºywotno≈õci
      </div>
    </div>

    <!-- NEW v3.3: BESS Sizing Variants (S/M/L) -->
    <div class="stats-section full-width sizing-variants-section" id="sizingVariantsSection" style="display:none;">
      <h2>üìä Warianty Doboru BESS (S/M/L)</h2>
      <div class="chart-info">
        Por√≥wnanie wariant√≥w pojemno≈õci z metrykami degradacji i bud≈ºetem cykli
      </div>
      <div class="sizing-variants-grid" id="sizingVariantsGrid">
        <!-- Dynamically filled by JS -->
      </div>
    </div>

    <!-- NEW v3.3: Degradation Budget Status -->
    <div class="stats-section full-width degradation-budget-section" id="degradationBudgetSection" style="display:none;">
      <h2>üìâ Bud≈ºet Degradacji</h2>
      <div class="stats-cards">
        <div class="stat-card bess-blue">
          <div class="stat-icon">üîÑ</div>
          <div class="stat-content">
            <div class="stat-label">Throughput Roczny</div>
            <div class="stat-value" id="budgetThroughput">0</div>
            <div class="stat-unit">MWh/rok</div>
            <div class="stat-detail" id="budgetThroughputLimit">Limit: - MWh</div>
          </div>
        </div>
        <div class="stat-card bess-purple">
          <div class="stat-icon">‚ôªÔ∏è</div>
          <div class="stat-content">
            <div class="stat-label">EFC (Cykle Ekwiwalentne)</div>
            <div class="stat-value" id="budgetEFC">0</div>
            <div class="stat-unit">/rok</div>
            <div class="stat-detail" id="budgetEFCLimit">Limit: - cykli</div>
          </div>
        </div>
        <div class="stat-card" id="budgetStatusCard">
          <div class="stat-icon" id="budgetStatusIcon">‚úÖ</div>
          <div class="stat-content">
            <div class="stat-label">Status Bud≈ºetu</div>
            <div class="stat-value" id="budgetStatus">OK</div>
            <div class="stat-detail" id="budgetUtilization">Wykorzystanie: 0%</div>
          </div>
        </div>
        <div class="stat-card bess-orange">
          <div class="stat-icon">‚ö°</div>
          <div class="stat-content">
            <div class="stat-label">Rozbicie Throughput</div>
            <div class="stat-value" id="budgetBreakdown">-</div>
            <div class="stat-detail" id="budgetBreakdownDetail">PV: - | Peak: -</div>
          </div>
        </div>
      </div>
    </div>

    <!-- NEW v3.3: STACKED Mode Info (if active) -->
    <div class="info-banner full-width stacked-mode-info" id="stackedModeInfo" style="display:none;">
      <div class="banner-icon">üîã‚ö°</div>
      <div class="banner-text">
        <strong>Tryb STACKED:</strong> Bateria ≈õwiadczy dwie us≈Çugi - Peak Shaving (priorytet 1) i PV Shifting (priorytet 2).
        <span id="stackedReserveInfo">Rezerwa SOC: 30% dla peak shaving.</span>
        <span id="stackedPeakLimit">Limit importu: - kW.</span>
      </div>
    </div>

    <!-- Technical Parameters -->
    <div class="details-section full-width">
      <h2>Parametry Techniczne BESS</h2>
      <div class="details-grid">
        <div class="detail-item">
          <span class="detail-label">Moc [kW]:</span>
          <span class="detail-value" id="bessPowerKw">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Pojemno≈õƒá [kWh]:</span>
          <span class="detail-value" id="bessEnergyKwh">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Duration [h]:</span>
          <span class="detail-value" id="bessDuration">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Sprawno≈õƒá roundtrip:</span>
          <span class="detail-value" id="bessRoundtrip">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">SOC min:</span>
          <span class="detail-value" id="bessSocMin">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">SOC max:</span>
          <span class="detail-value" id="bessSocMax">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Degradacja rok 1:</span>
          <span class="detail-value" id="bessDegYear1">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Degradacja lata 2+:</span>
          <span class="detail-value" id="bessDegYearN">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">≈ªywotno≈õƒá baterii:</span>
          <span class="detail-value" id="bessLifetime">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Tryb pracy:</span>
          <span class="detail-value" id="bessMode">0-Export</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">CAPEX per kWh:</span>
          <span class="detail-value" id="bessCapexKwh">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">CAPEX per kW:</span>
          <span class="detail-value" id="bessCapexKw">-</span>
        </div>
      </div>
    </div>

    <!-- Footer Info -->
    <div class="info-banner full-width">
      <div class="banner-icon">‚ÑπÔ∏è</div>
      <div class="banner-text">
        <strong>Tryb 0-Export:</strong> Energia PV nie jest eksportowana do sieci. Nadwy≈ºka najpierw ≈Çaduje bateriƒô,
        a gdy jest pe≈Çna - energia jest curtailowana (stracona). Bateria roz≈Çadowuje siƒô gdy produkcja PV nie pokrywa zapotrzebowania.
      </div>
    </div>

    <!-- Actions -->
    <div class="actions-section full-width">
      <button class="btn" onclick="exportBessData()">üì• Eksportuj dane BESS</button>
      <button class="btn btn-secondary" onclick="refreshData()">üîÑ Od≈õwie≈º dane</button>
    </div>
  </div>

  <!-- No Data Message -->
  <div id="noDataMessage" class="no-data" style="display:none;">
    <div class="no-data-icon">üîã</div>
    <h3>Brak danych BESS</h3>
    <p>W≈ÇƒÖcz BESS w module USTAWIENIA i wykonaj analizƒô w module KONFIGURACJA.</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<script src="bess.js?v=3.3.1"></script>
</body>
</html>
