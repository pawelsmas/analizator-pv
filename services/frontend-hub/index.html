<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PV Analyzer - HUB</title>
    <link rel="stylesheet" href="hub.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">&#9889;</span>
                    <h1>PV Analyzer</h1>
                </div>
                <nav class="nav">
                    <a href="#" class="nav-link active">Dashboard</a>
                    <a href="#" onclick="navigateToModule('settings'); return false;" class="nav-link">Ustawienia</a>
                </nav>
                <div class="user-section">
                    <select id="companySelect" class="company-select">
                        <option value="">Wybierz firm&#281;...</option>
                    </select>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Project Selection -->
            <section class="section project-section">
                <div class="section-header">
                    <h2>Aktywny projekt</h2>
                    <button class="btn btn-primary" onclick="showNewProjectModal()">+ Nowy projekt</button>
                </div>
                <div class="project-selector">
                    <select id="projectSelect" class="project-select">
                        <option value="">Wybierz projekt...</option>
                    </select>
                    <div id="projectInfo" class="project-info hidden">
                        <div class="project-badges">
                            <span id="badgeLocation" class="badge badge-info"></span>
                            <span id="badgeMode" class="badge badge-primary"></span>
                            <span id="badgeStatus" class="badge badge-success"></span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Analysis Mode Selection -->
            <section class="section">
                <h2>Wybierz tryb analizy</h2>
                <p class="section-description">Ka&#380;dy tryb oferuje inne mo&#380;liwo&#347;ci obliczeniowe</p>

                <div class="modes-grid" id="modesGrid">
                    <!-- PV Solo -->
                    <div class="mode-card" data-mode="pv_solo">
                        <div class="mode-icon mode-icon-pv">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="10" rx="2"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                <line x1="12" y1="3" x2="12" y2="1"/>
                                <line x1="5" y1="5" x2="3.5" y2="3.5"/>
                                <line x1="19" y1="5" x2="20.5" y2="3.5"/>
                            </svg>
                        </div>
                        <h3>Tylko PV</h3>
                        <p>Dob&#243;r optymalnej wielko&#347;ci instalacji fotowoltaicznej do profilu zu&#380;ycia</p>
                        <div class="mode-requirements">
                            <span class="req req-required">Profil zu&#380;ycia</span>
                        </div>
                        <button class="btn btn-mode" onclick="selectMode('pv_solo')">Wybierz</button>
                    </div>

                    <!-- PV + BESS -->
                    <div class="mode-card" data-mode="pv_bess">
                        <div class="mode-icon mode-icon-bess">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="14" rx="2"/>
                                <path d="M6 7V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2"/>
                                <line x1="12" y1="11" x2="12" y2="17"/>
                                <line x1="9" y1="14" x2="15" y2="14"/>
                            </svg>
                        </div>
                        <h3>PV + BESS</h3>
                        <p>Kompleksowa analiza PV z magazynem energii - autokonsumpcja i zero-export</p>
                        <div class="mode-requirements">
                            <span class="req req-required">Profil zu&#380;ycia</span>
                            <span class="req req-required">Profil PV</span>
                        </div>
                        <div class="mode-suboptions">
                            <label><input type="checkbox" id="pvBessPeakShaving"> + Peak Shaving</label>
                            <label><input type="checkbox" id="pvBessArbitrage"> + Arbitra&#380; cenowy</label>
                        </div>
                        <button class="btn btn-mode" onclick="selectMode('pv_bess')">Wybierz</button>
                    </div>

                    <!-- BESS Solo -->
                    <div class="mode-card" data-mode="bess_solo">
                        <div class="mode-icon mode-icon-storage">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                                <rect x="8" y="8" width="8" height="8" rx="1"/>
                                <line x1="12" y1="2" x2="12" y2="4"/>
                                <line x1="12" y1="20" x2="12" y2="22"/>
                            </svg>
                        </div>
                        <h3>Tylko BESS</h3>
                        <p>Magazyn energii bez PV - peak shaving lub arbitra&#380; cenowy</p>
                        <div class="mode-requirements">
                            <span class="req req-required">Profil zu&#380;ycia</span>
                        </div>
                        <div class="mode-suboptions">
                            <label><input type="radio" name="bessStrategy" value="peak_shaving" checked> Peak Shaving</label>
                            <label><input type="radio" name="bessStrategy" value="arbitrage"> Arbitra&#380; cenowy</label>
                        </div>
                        <button class="btn btn-mode" onclick="selectMode('bess_solo')">Wybierz</button>
                    </div>
                </div>
            </section>

            <!-- Quick Stats -->
            <section class="section">
                <h2>Statystyki systemu</h2>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-value" id="statCompanies">-</div>
                        <div class="stat-label">Firm</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statProjects">-</div>
                        <div class="stat-label">Projekt&#243;w</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statProfiles">-</div>
                        <div class="stat-label">Profili energetycznych</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statAnalyses">-</div>
                        <div class="stat-label">Wykonanych analiz</div>
                    </div>
                </div>
            </section>

            <!-- BESS Analysis Hub -->
            <section class="section">
                <h2>Analiza magazynu energii (BESS)</h2>
                <p class="section-description">Dwa komplementarne moduły do kompleksowej analizy BESS</p>
                <div class="bess-modules-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:16px;">
                    <!-- BESS Module Card -->
                    <div class="bess-module-card" onclick="navigateToModule('bess')" style="background:linear-gradient(135deg,#fff3e0 0%,#ffe0b2 100%);border-radius:12px;padding:20px;cursor:pointer;border:2px solid #ffcc80;transition:all 0.3s;">
                        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
                            <span style="font-size:32px;">&#128267;</span>
                            <div>
                                <h3 style="margin:0;color:#e65100;">Moduł BESS</h3>
                                <span style="font-size:12px;color:#f57c00;">Wizualizacja i monitoring</span>
                            </div>
                        </div>
                        <ul style="font-size:13px;color:#795548;margin:0;padding-left:20px;line-height:1.8;">
                            <li>Animacja przepływu energii w czasie rzeczywistym</li>
                            <li>Tabela degradacji baterii (15 lat)</li>
                            <li>Analiza wrażliwości (Tornado Chart)</li>
                            <li>Wykres SOC (State of Charge)</li>
                            <li>Bilans miesięczny BESS</li>
                        </ul>
                    </div>
                    <!-- Profile Analysis Card -->
                    <div class="bess-module-card" onclick="navigateToModule('profile')" style="background:linear-gradient(135deg,#e3f2fd 0%,#bbdefb 100%);border-radius:12px;padding:20px;cursor:pointer;border:2px solid #90caf9;transition:all 0.3s;">
                        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
                            <span style="font-size:32px;">&#128202;</span>
                            <div>
                                <h3 style="margin:0;color:#1565c0;">Analiza Profilu PyPSA</h3>
                                <span style="font-size:12px;color:#1976d2;">Optymalizacja i dobór</span>
                            </div>
                        </div>
                        <ul style="font-size:13px;color:#37474f;margin:0;padding-left:20px;line-height:1.8;">
                            <li>Optymalizacja PyPSA + HiGHS</li>
                            <li>Pareto Front (NPV vs Cykle)</li>
                            <li>Peak Shaving (redukcja szczytów)</li>
                            <li>Arbitraż cenowy RDN</li>
                            <li>Heatmapa godzinowa zużycia</li>
                        </ul>
                    </div>
                </div>
                <div style="margin-top:16px;padding:12px;background:#f5f5f5;border-radius:8px;font-size:12px;color:#666;">
                    <strong>Tip:</strong> Moduły współdzielą konfigurację BESS. Zacznij od Analizy Profilu (dobór optymalnego rozmiaru),
                    następnie przejdź do Modułu BESS (szczegółowa wizualizacja wybranego wariantu).
                </div>
            </section>

            <!-- Quick Links -->
            <section class="section">
                <h2>Szybkie akcje</h2>
                <div class="quick-links">
                    <a href="#" onclick="navigateToModule('consumption'); return false;" class="quick-link">
                        <span class="quick-icon">&#128200;</span>
                        <span>Wgraj profil zu&#380;ycia</span>
                    </a>
                    <a href="#" onclick="navigateToModule('production'); return false;" class="quick-link">
                        <span class="quick-icon">&#9728;</span>
                        <span>Generuj profil PV (PVGIS)</span>
                    </a>
                    <a href="#" onclick="navigateToModule('config'); return false;" class="quick-link">
                        <span class="quick-icon">&#9881;</span>
                        <span>Konfiguracja PV</span>
                    </a>
                    <a href="#" onclick="navigateToModule('economics'); return false;" class="quick-link">
                        <span class="quick-icon">&#128176;</span>
                        <span>Ekonomika + Monte Carlo</span>
                    </a>
                    <a href="#" onclick="navigateToModule('reports'); return false;" class="quick-link">
                        <span class="quick-icon">&#128196;</span>
                        <span>Generuj raport PDF</span>
                    </a>
                    <a href="#" onclick="navigateToModule('estimator'); return false;" class="quick-link">
                        <span class="quick-icon">&#129518;</span>
                        <span>Szybka wycena</span>
                    </a>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>PV Analyzer v2.0 | PostgreSQL + PyPSA + HiGHS</p>
        </footer>
    </div>

    <!-- New Project Modal -->
    <div id="newProjectModal" class="modal hidden">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h3>Nowy projekt</h3>
                <button class="modal-close" onclick="hideNewProjectModal()">&times;</button>
            </div>
            <form id="newProjectForm" onsubmit="createProject(event)">
                <!-- STEP 1: Company Search/Create -->
                <div class="form-section">
                    <h4>1. Firma</h4>
                    <div class="form-group">
                        <label for="companySearch">Wyszukaj firm&#281; (nazwa lub NIP)</label>
                        <div class="search-container">
                            <input type="text" id="companySearch" placeholder="Wpisz nazw&#281; firmy lub NIP..." oninput="searchCompanies(this.value)" autocomplete="off">
                            <div id="companySearchResults" class="search-results hidden"></div>
                        </div>
                    </div>
                    <div id="selectedCompanyInfo" class="selected-company hidden">
                        <div class="company-badge">
                            <span id="selectedCompanyName">-</span>
                            <span id="selectedCompanyNip" class="nip-badge">NIP: -</span>
                            <button type="button" class="btn-clear" onclick="clearSelectedCompany()">&times;</button>
                        </div>
                    </div>
                    <div id="newCompanyForm" class="new-company-form hidden">
                        <p class="info-text">Firma nie znaleziona - utw&#243;rz now&#261;:</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newCompanyName">Nazwa firmy *</label>
                                <input type="text" id="newCompanyName" placeholder="Nazwa firmy">
                            </div>
                            <div class="form-group">
                                <label for="newCompanyNip">NIP *</label>
                                <input type="text" id="newCompanyNip" placeholder="1234567890" maxlength="10">
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="selectedCompanyId" value="">
                </div>

                <!-- STEP 2: Project Details -->
                <div class="form-section">
                    <h4>2. Projekt</h4>
                    <div class="form-group">
                        <label for="projectName">Nazwa projektu *</label>
                        <input type="text" id="projectName" required placeholder="np. Instalacja PV - Zak&#322;ad Krak&#243;w">
                    </div>
                    <div class="form-group">
                        <label for="projectLocation">Lokalizacja</label>
                        <input type="text" id="projectLocation" placeholder="np. Krak&#243;w, ul. Przemys&#322;owa 15">
                    </div>
                </div>

                <!-- STEP 3: Analysis Mode -->
                <div class="form-section">
                    <h4>3. Tryb analizy</h4>
                    <div class="mode-selector">
                        <label class="mode-option">
                            <input type="radio" name="projectMode" value="pv_solo">
                            <span class="mode-label">
                                <strong>Tylko PV</strong>
                                <small>Dob&#243;r wielko&#347;ci instalacji PV</small>
                            </span>
                        </label>
                        <label class="mode-option">
                            <input type="radio" name="projectMode" value="pv_bess" checked>
                            <span class="mode-label">
                                <strong>PV + BESS</strong>
                                <small>PV z magazynem energii</small>
                            </span>
                        </label>
                        <label class="mode-option">
                            <input type="radio" name="projectMode" value="bess_solo">
                            <span class="mode-label">
                                <strong>Tylko BESS</strong>
                                <small>Magazyn energii bez PV</small>
                            </span>
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="hideNewProjectModal()">Anuluj</button>
                    <button type="submit" class="btn btn-primary" id="createProjectBtn">Utw&#243;rz projekt</button>
                </div>
            </form>
        </div>
    </div>

    <script src="hub.js"></script>
</body>
</html>
