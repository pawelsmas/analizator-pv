<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analiza Profilu PV+BESS v2.0</title>
    <link rel="stylesheet" href="profile.css?v=20251210-EXPORT">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üìä Analiza Profilu PV + BESS v2.0</h1>
            <p>Optymalizacja multi-obiektywowa z integracjƒÖ PyPSA</p>
        </header>

        <div id="errorMessage"></div>

        <!-- Configuration Panel -->
        <section class="config-panel">
            <h2>Parametry analizy</h2>
            <div class="config-grid">
                <div class="form-group">
                    <label for="pvCapacity">Moc PV [kWp]</label>
                    <input type="number" id="pvCapacity" value="1200" min="10" step="10">
                </div>
                <div class="form-group">
                    <label for="bessEnergy">Pojemno≈õƒá BESS [kWh]</label>
                    <input type="number" id="bessEnergy" value="2000" min="0" step="100">
                </div>
                <div class="form-group">
                    <label for="bessPower">Moc BESS [kW]</label>
                    <input type="number" id="bessPower" value="500" min="0" step="50">
                </div>
                <div class="form-group">
                    <label for="bessEfficiency">Sprawno≈õƒá BESS [%]</label>
                    <input type="number" id="bessEfficiency" value="90" min="70" max="98" step="1">
                </div>
                <div class="form-group">
                    <label for="energyPrice">Cena energii [PLN/MWh]</label>
                    <input type="number" id="energyPrice" value="800" min="100" step="50">
                </div>
                <div class="form-group">
                    <label for="bessCapexKwh">CAPEX BESS [PLN/kWh]</label>
                    <input type="number" id="bessCapexKwh" value="1500" min="500" step="100">
                </div>
                <div class="form-group">
                    <label for="bessCapexKw">CAPEX BESS [PLN/kW]</label>
                    <input type="number" id="bessCapexKw" value="300" min="0" step="50">
                </div>
                <div class="form-group">
                    <label for="discountRate">Stopa dyskontowa [%]</label>
                    <input type="number" id="discountRate" value="8" min="0" max="20" step="0.5">
                </div>
                <div class="form-group">
                    <label for="projectYears">Okres analizy [lat]</label>
                    <input type="number" id="projectYears" value="15" min="5" max="25" step="1">
                </div>
                <div class="form-group">
                    <label for="strategy">Strategia optymalizacji</label>
                    <select id="strategy">
                        <option value="npv_max">NPV Max (najwiƒôkszy zwrot)</option>
                        <option value="cycles_max">Cycles Max (max cykli)</option>
                        <option value="balanced" selected>Balanced (r√≥wnowaga NPV/cykle)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="minCycles">Min. cykli rocznie</label>
                    <input type="number" id="minCycles" value="200" min="50" max="500" step="10">
                </div>
                <div class="form-group">
                    <label for="maxCycles">Max. cykli rocznie</label>
                    <input type="number" id="maxCycles" value="365" min="200" max="700" step="10">
                </div>
                <button id="analyzeBtn" class="btn-analyze">üî¨ Analizuj profil (PyPSA)</button>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="summary">Podsumowanie</button>
                <button class="tab-btn" data-tab="pareto">Pareto Front</button>
                <button class="tab-btn" data-tab="heatmap">Heatmapa</button>
                <button class="tab-btn" data-tab="variants">Por√≥wnanie wariant√≥w</button>
                <button class="tab-btn" data-tab="hourly">Profil godzinowy</button>
                <button class="tab-btn" data-tab="monthly">Analiza miesiƒôczna</button>
                <button class="tab-btn" data-tab="quarterly">Kwarta≈Çy</button>
                <button class="tab-btn" data-tab="bessRec">Rekomendacje BESS</button>
                <button class="tab-btn" data-tab="pvRec">Rekomendacje PV</button>
                <button class="tab-btn" data-tab="insights">Wnioski</button>
            </div>

            <!-- Summary Tab -->
            <div id="summaryTab" class="tab-panel active">
                <h3>Podsumowanie roczne</h3>
                <div id="summaryContent"></div>
                <div id="selectedStrategy" class="strategy-badge"></div>
            </div>

            <!-- Pareto Front Tab -->
            <div id="paretoTab" class="tab-panel">
                <h3>Pareto Front: NPV vs Cykle</h3>
                <p class="description">Punkty Pareto-optymalne - ka≈ºdy jest optymalny dla r√≥≈ºnego kompromisu miƒôdzy NPV a liczbƒÖ cykli</p>
                <div class="chart-container pareto-chart">
                    <canvas id="paretoChart"></canvas>
                </div>
                <div id="paretoTable" class="pareto-table-container"></div>
            </div>

            <!-- Heatmap Tab -->
            <div id="heatmapTab" class="tab-panel">
                <h3>Heatmapa surplus/deficit</h3>
                <p class="description">Rozk≈Çad nadwy≈ºek i deficyt√≥w: 24 godziny √ó 12 miesiƒôcy</p>
                <div id="heatmapContainer" class="heatmap-container"></div>
                <div class="heatmap-legend">
                    <span class="legend-deficit">‚Üê Deficyt</span>
                    <span class="legend-neutral">Bilans</span>
                    <span class="legend-surplus">Nadwy≈ºka ‚Üí</span>
                </div>
            </div>

            <!-- Variants Comparison Tab -->
            <div id="variantsTab" class="tab-panel">
                <h3>Por√≥wnanie wariant√≥w</h3>
                <p class="description">Side-by-side por√≥wnanie: Bez BESS vs Rekomendowany BESS</p>
                <div id="variantsContent" class="variants-grid"></div>
            </div>

            <!-- Hourly Tab -->
            <div id="hourlyTab" class="tab-panel">
                <h3>≈öredni profil godzinowy</h3>
                <p class="description">≈örednie warto≈õci dla ka≈ºdej godziny w ciƒÖgu roku</p>
                <div class="chart-container">
                    <canvas id="hourlyChart"></canvas>
                </div>
            </div>

            <!-- Monthly Tab -->
            <div id="monthlyTab" class="tab-panel">
                <h3>Analiza miesiƒôczna</h3>
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>MiesiƒÖc</th>
                                <th>PV<br>[MWh]</th>
                                <th>Zu≈ºycie<br>[MWh]</th>
                                <th>Nadwy≈ºka<br>[MWh]</th>
                                <th>Deficyt<br>[MWh]</th>
                                <th>≈ör. nadwy≈ºka<br>[kWh/d]</th>
                                <th>Godzin<br>nadwy≈ºki/d</th>
                                <th>Opt. BESS<br>[kWh]</th>
                                <th>Cykle<br>BESS</th>
                                <th>Eksport</th>
                            </tr>
                        </thead>
                        <tbody id="monthlyTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- Export Section -->
                <div class="export-section" style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 8px; border: 1px solid #64b5f6;">
                    <h4 style="margin: 0 0 10px 0; color: #1565c0;">üì• Eksport szczeg√≥≈Çowych danych godzinowych</h4>
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <label style="font-weight: 500;">Wybierz miesiƒÖc:</label>
                        <select id="exportMonthSelect" style="padding: 8px 12px; border-radius: 4px; border: 1px solid #64b5f6; font-size: 14px; min-width: 150px;">
                            <option value="0">üìÖ Ca≈Çy rok (wszystkie miesiƒÖce)</option>
                            <option value="1">Stycze≈Ñ</option>
                            <option value="2">Luty</option>
                            <option value="3">Marzec</option>
                            <option value="4">Kwiecie≈Ñ</option>
                            <option value="5" selected>Maj</option>
                            <option value="6">Czerwiec</option>
                            <option value="7">Lipiec</option>
                            <option value="8">Sierpie≈Ñ</option>
                            <option value="9">Wrzesie≈Ñ</option>
                            <option value="10">Pa≈∫dziernik</option>
                            <option value="11">Listopad</option>
                            <option value="12">Grudzie≈Ñ</option>
                        </select>
                        <button id="exportMonthBtn" onclick="exportMonthlyHourlyData()" style="padding: 10px 20px; background: #1976d2; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px;">
                            üìä Eksportuj do Excel
                        </button>
                        <span id="exportInfo" style="color: #666; font-size: 12px;">Zawiera: Load, PV, Nadwy≈ºka, ≈Åadowanie BESS, Roz≈Çadowanie BESS</span>
                    </div>
                </div>
            </div>

            <!-- Quarterly Tab -->
            <div id="quarterlyTab" class="tab-panel">
                <h3>Rozk≈Çad kwartalny</h3>
                <p class="description">Por√≥wnanie aktywno≈õci BESS w poszczeg√≥lnych kwarta≈Çach</p>
                <div id="quarterlyContent"></div>
            </div>

            <!-- BESS Recommendations Tab -->
            <div id="bessRecTab" class="tab-panel">
                <h3>Rekomendacje rozmiaru BESS</h3>
                <p class="description">Optymalne warianty rozmiaru magazynu dla Twojego profilu (symulacja PyPSA)</p>
                <div id="bessRecommendations"></div>
            </div>

            <!-- PV Recommendations Tab -->
            <div id="pvRecTab" class="tab-panel">
                <h3>Rekomendacje przewymiarowania PV</h3>
                <p class="description">Ile dodatkowego PV potrzeba dla lepszego wykorzystania BESS</p>
                <div id="pvRecommendations"></div>
            </div>

            <!-- Insights Tab -->
            <div id="insightsTab" class="tab-panel">
                <h3>Kluczowe wnioski</h3>
                <div id="insightsContent"></div>
            </div>
        </section>
    </div>

    <!-- Loading Overlay -->
    <div id="loading">
        <div class="spinner"></div>
        <p id="loadingText">Uruchamiam optymalizacjƒô PyPSA...</p>
    </div>

    <script src="profile.js?v=20251211-DIRECT-CONSUMPTION"></script>
</body>
</html>
