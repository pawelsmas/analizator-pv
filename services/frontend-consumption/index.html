<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Analiza Zu≈ºycia</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="consumption-container">
  <div class="page-header">
    <h1>üìä ANALIZA ZU≈ªYCIA ENERGII</h1>
    <div class="header-info">
      <span id="dataInfo">Brak danych</span>
    </div>
  </div>

  <div class="content-grid">
    <!-- Statystyki podstawowe -->
    <div class="stats-section">
      <h2>Statystyki Roczne</h2>
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-icon">‚ö°</div>
          <div class="stat-content">
            <div class="stat-label">Zu≈ºycie Roczne</div>
            <div class="stat-value" id="annualConsumption">-</div>
            <div class="stat-unit">GWh</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìà</div>
          <div class="stat-content">
            <div class="stat-label">Moc Szczytowa</div>
            <div class="stat-value" id="peakPower">-</div>
            <div class="stat-unit">MW</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìâ</div>
          <div class="stat-content">
            <div class="stat-label">Moc Minimalna</div>
            <div class="stat-value" id="minPower">-</div>
            <div class="stat-unit">kW</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-content">
            <div class="stat-label">≈örednia Dzienna</div>
            <div class="stat-value" id="avgDaily">-</div>
            <div class="stat-unit">MWh</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profil dobowy -->
    <div class="chart-section">
      <h2>≈öredni Profil Dobowy</h2>
      <div class="chart-info">
        ≈örednie godzinowe zu≈ºycie w ciƒÖgu doby
      </div>
      <canvas id="dailyProfile"></canvas>
    </div>

    <!-- Profil tygodniowy -->
    <div class="chart-section">
      <h2>Profil Tygodniowy</h2>
      <div class="chart-info">
        ≈örednie dobowe zu≈ºycie wed≈Çug dnia tygodnia
      </div>
      <canvas id="weeklyProfile"></canvas>
    </div>

    <!-- Profil miesiƒôczny -->
    <div class="chart-section full-width">
      <h2>Profil Miesiƒôczny</h2>
      <div class="chart-info">
        Zu≈ºycie w poszczeg√≥lnych miesiƒÖcach
      </div>
      <canvas id="monthlyProfile"></canvas>
    </div>

    <!-- Analiza sezonowo≈õci -->
    <div class="chart-section full-width" id="seasonalitySection" style="display:none">
      <h2>Analiza Sezonowo≈õci</h2>
      <div class="chart-info">
        Klasyfikacja dni wed≈Çug zu≈ºycia: High (wysoki) / Mid (≈õredni) / Low (niski)
      </div>
      <div id="seasonalityStats" class="seasonality-stats">
        <div class="seasonality-stat high">
          <span class="band-label">HIGH</span>
          <span id="highDaysCount" class="band-count">-</span>
          <span class="band-unit">dni</span>
        </div>
        <div class="seasonality-stat mid">
          <span class="band-label">MID</span>
          <span id="midDaysCount" class="band-count">-</span>
          <span class="band-unit">dni</span>
        </div>
        <div class="seasonality-stat low">
          <span class="band-label">LOW</span>
          <span id="lowDaysCount" class="band-count">-</span>
          <span class="band-unit">dni</span>
        </div>
        <div class="seasonality-stat score">
          <span class="band-label">WYNIK</span>
          <span id="seasonalityScore" class="band-count">-</span>
          <span class="band-unit">%</span>
        </div>
      </div>

      <!-- Tabela miesiƒôcy z podzia≈Çem na pasma -->
      <div id="monthlyBandsTable" class="monthly-bands-section" style="margin-top:20px">
        <h3 style="font-size:16px;color:#2c3e50;margin-bottom:12px">Podzia≈Ç Miesiƒôcy na Pasma Sezonowo≈õci</h3>
        <div class="bands-summary" style="display:flex;gap:20px;margin-bottom:16px;flex-wrap:wrap">
          <div id="highMonthsList" class="band-months-box high">
            <div class="band-header">HIGH - Wysokie zu≈ºycie</div>
            <div class="band-months-list">-</div>
            <div class="band-consumption">-</div>
          </div>
          <div id="midMonthsList" class="band-months-box mid">
            <div class="band-header">MID - ≈örednie zu≈ºycie</div>
            <div class="band-months-list">-</div>
            <div class="band-consumption">-</div>
          </div>
          <div id="lowMonthsList" class="band-months-box low">
            <div class="band-header">LOW - Niskie zu≈ºycie</div>
            <div class="band-months-list">-</div>
            <div class="band-consumption">-</div>
          </div>
        </div>

        <!-- Szczeg√≥≈Çowa tabela miesiƒôcy -->
        <div class="monthly-details-table" style="overflow-x:auto">
          <table id="monthlyBandsDetailTable" style="width:100%;border-collapse:collapse;font-size:13px">
            <thead>
              <tr style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white">
                <th style="padding:10px;text-align:left;border-radius:8px 0 0 0">MiesiƒÖc</th>
                <th style="padding:10px;text-align:center">Pasmo</th>
                <th style="padding:10px;text-align:right">Zu≈ºycie [MWh]</th>
                <th style="padding:10px;text-align:right">P95 Mocy [kW]</th>
                <th style="padding:10px;text-align:right">≈ör. Moc [kW]</th>
                <th style="padding:10px;text-align:right;border-radius:0 8px 0 0">% Rocznego</th>
              </tr>
            </thead>
            <tbody id="monthlyBandsTableBody">
              <!-- Wype≈Çniane dynamicznie -->
            </tbody>
          </table>
        </div>

        <!-- Rekomendowane moce AC dla pasm -->
        <div id="recommendedPowers" class="recommended-powers-section" style="margin-top:20px;padding:16px;background:#f8f9fa;border-radius:8px">
          <h4 style="font-size:14px;color:#2c3e50;margin-bottom:12px">Rekomendowane Limity Mocy AC dla Optymalizacji PV</h4>
          <div class="powers-grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
            <div class="power-card high" style="padding:12px;border-radius:8px;text-align:center">
              <div style="font-size:11px;font-weight:600;text-transform:uppercase;opacity:0.8">HIGH</div>
              <div id="highPowerRecommended" style="font-size:24px;font-weight:700">- kW</div>
              <div style="font-size:10px;opacity:0.7">P95 z okresu HIGH</div>
            </div>
            <div class="power-card mid" style="padding:12px;border-radius:8px;text-align:center">
              <div style="font-size:11px;font-weight:600;text-transform:uppercase;opacity:0.8">MID</div>
              <div id="midPowerRecommended" style="font-size:24px;font-weight:700">- kW</div>
              <div style="font-size:10px;opacity:0.7">P95 z okresu MID</div>
            </div>
            <div class="power-card low" style="padding:12px;border-radius:8px;text-align:center">
              <div style="font-size:11px;font-weight:600;text-transform:uppercase;opacity:0.8">LOW</div>
              <div id="lowPowerRecommended" style="font-size:24px;font-weight:700">- kW</div>
              <div style="font-size:10px;opacity:0.7">P95 z okresu LOW</div>
            </div>
          </div>
          <div style="margin-top:12px;font-size:11px;color:#666;padding:8px;background:#e8f5e9;border-radius:4px;border-left:3px solid #4caf50">
            Te limity mocy AC sƒÖ u≈ºywane w strategii <strong>PASMA SEZONOWO≈öƒÜ</strong> do ograniczenia eksportu energii w okresach niskiego zapotrzebowania.
          </div>
        </div>
      </div>

      <canvas id="seasonalityChart" style="margin-top:20px"></canvas>
      <div id="seasonalityMessage" class="seasonality-message"></div>
    </div>

    <!-- Analiza rozk≈Çadu mocy z Peak Shaving -->
    <div class="chart-section" style="max-width: 780px;">
        <h2>üìä Krzywa UporzƒÖdkowana Mocy (Load Duration Curve)</h2>
        <div class="chart-info">
          Rozk≈Çad mocy od najwiƒôkszej do najmniejszej - analiza potencja≈Çu peak shaving
        </div>
        <div style="height: 380px; margin-bottom: 24px;">
          <canvas id="loadDurationCurve"></canvas>
        </div>

        <!-- Peak Shaving Analysis Table -->
        <div id="peakShavingAnalysis">
          <h3 style="margin: 0 0 12px 0; color: #2c3e50; font-size: 15px;">
            ‚ö° Analiza Peak Shaving - Percentyle Mocy
          </h3>
          <div style="background: #f8f9fa; padding: 10px 12px; border-radius: 6px; margin-bottom: 12px;">
            <p style="margin: 0; font-size: 12px; color: #495057;">
              <strong>üí°</strong> Percentyl P99 = moc przekraczana przez 1% czasu (~88h/rok).
            </p>
          </div>

          <table id="peakShavingTable" style="width: 100%; border-collapse: collapse; font-size: 12px; background: white; border-radius: 6px; overflow: hidden; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
            <thead>
              <tr style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white;">
                <th style="padding: 10px 6px; text-align: left; font-weight: 600;">Pr√≥g</th>
                <th style="padding: 10px 6px; text-align: right; font-weight: 600;">Moc [kW]</th>
                <th style="padding: 10px 6px; text-align: right; font-weight: 600;">Godz/rok</th>
                <th style="padding: 10px 6px; text-align: right; font-weight: 600;">Energia [kWh]</th>
                <th style="padding: 10px 6px; text-align: right; font-weight: 600;">Redukcja</th>
                <th style="padding: 10px 6px; text-align: center; font-weight: 600;">Ocena</th>
              </tr>
            </thead>
            <tbody id="peakShavingTableBody">
              <tr><td colspan="6" style="padding: 16px; text-align: center; color: #7f8c8d;">≈Åadowanie danych...</td></tr>
            </tbody>
          </table>

        <!-- Rekomendacja -->
        <div id="peakShavingRecommendation" style="margin-top: 12px; padding: 12px; border-radius: 6px; display: none;">
        </div>
      </div>
    </div>

    <!-- Statystyki szczeg√≥≈Çowe -->
    <div class="details-section">
      <h2>Statystyki Szczeg√≥≈Çowe</h2>
      <div class="details-grid">
        <div class="detail-item">
          <span class="detail-label">≈örednia Moc:</span>
          <span class="detail-value" id="avgPower">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Odchylenie Standardowe:</span>
          <span class="detail-value" id="stdDev">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Wsp√≥≈Çczynnik Zmienno≈õci:</span>
          <span class="detail-value" id="variationCoef">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Wsp√≥≈Çczynnik ObciƒÖ≈ºenia:</span>
          <span class="detail-value" id="loadFactor">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Ilo≈õƒá Pomiar√≥w:</span>
          <span class="detail-value" id="dataPoints">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Okres Danych:</span>
          <span class="detail-value" id="dataPeriod">-</span>
        </div>
      </div>
    </div>

    <!-- Akcje -->
    <div class="actions-section full-width">
      <button class="btn" onclick="exportAnalysis()">üì• Eksportuj do Excel</button>
      <button class="btn btn-secondary" onclick="refreshData()">üîÑ Od≈õwie≈º Dane</button>
    </div>
  </div>

  <!-- Info gdy brak danych -->
  <div id="noDataMessage" class="no-data">
    <div class="no-data-icon">üìä</div>
    <h3>Brak Danych do Analizy</h3>
    <p>Przejd≈∫ do modu≈Çu Configuration i za≈Çaduj dane zu≈ºycia energii.</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="consumption.js?v=20251211-EXCEL-EXPORT"></script>
</body>
</html>
