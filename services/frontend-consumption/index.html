<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Analiza ZuÅ¼ycia</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="consumption-container">
  <div class="page-header">
    <h1>ðŸ“Š ANALIZA ZUÅ»YCIA ENERGII</h1>
    <div class="header-info">
      <span id="dataInfo">Brak danych</span>
    </div>
  </div>

  <div class="content-grid">
    <!-- Statystyki podstawowe -->
    <div class="stats-section">
      <h2>Statystyki Roczne</h2>
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-icon">âš¡</div>
          <div class="stat-content">
            <div class="stat-label">ZuÅ¼ycie Roczne</div>
            <div class="stat-value" id="annualConsumption">-</div>
            <div class="stat-unit">GWh</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ðŸ“ˆ</div>
          <div class="stat-content">
            <div class="stat-label">Moc Szczytowa</div>
            <div class="stat-value" id="peakPower">-</div>
            <div class="stat-unit">MW</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ðŸ“‰</div>
          <div class="stat-content">
            <div class="stat-label">Moc Minimalna</div>
            <div class="stat-value" id="minPower">-</div>
            <div class="stat-unit">kW</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ðŸ“Š</div>
          <div class="stat-content">
            <div class="stat-label">Åšrednia Dzienna</div>
            <div class="stat-value" id="avgDaily">-</div>
            <div class="stat-unit">MWh</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profil dobowy -->
    <div class="chart-section">
      <h2>Åšredni Profil Dobowy</h2>
      <div class="chart-info">
        Åšrednie godzinowe zuÅ¼ycie w ciÄ…gu doby
      </div>
      <canvas id="dailyProfile"></canvas>
    </div>

    <!-- Profil tygodniowy -->
    <div class="chart-section">
      <h2>Profil Tygodniowy</h2>
      <div class="chart-info">
        Åšrednie dobowe zuÅ¼ycie wedÅ‚ug dnia tygodnia
      </div>
      <canvas id="weeklyProfile"></canvas>
    </div>

    <!-- Profil miesiÄ™czny -->
    <div class="chart-section full-width">
      <h2>Profil MiesiÄ™czny</h2>
      <div class="chart-info">
        ZuÅ¼ycie w poszczegÃ³lnych miesiÄ…cach
      </div>
      <canvas id="monthlyProfile"></canvas>
    </div>

    <!-- Analiza sezonowoÅ›ci -->
    <div class="chart-section full-width" id="seasonalitySection" style="display:none">
      <h2>Analiza SezonowoÅ›ci</h2>
      <div class="chart-info">
        Klasyfikacja dni wedÅ‚ug zuÅ¼ycia: High (wysoki) / Mid (Å›redni) / Low (niski)
      </div>
      <div id="seasonalityStats" class="seasonality-stats">
        <div class="seasonality-stat high">
          <span class="band-label">HIGH</span>
          <span id="highDaysCount" class="band-count">-</span>
          <span class="band-unit">dni</span>
        </div>
        <div class="seasonality-stat mid">
          <span class="band-label">MID</span>
          <span id="midDaysCount" class="band-count">-</span>
          <span class="band-unit">dni</span>
        </div>
        <div class="seasonality-stat low">
          <span class="band-label">LOW</span>
          <span id="lowDaysCount" class="band-count">-</span>
          <span class="band-unit">dni</span>
        </div>
        <div class="seasonality-stat score">
          <span class="band-label">WYNIK</span>
          <span id="seasonalityScore" class="band-count">-</span>
          <span class="band-unit">%</span>
        </div>
      </div>

      <!-- Tabela miesiÄ™cy z podziaÅ‚em na pasma -->
      <div id="monthlyBandsTable" class="monthly-bands-section" style="margin-top:20px">
        <h3 style="font-size:16px;color:#2c3e50;margin-bottom:12px">PodziaÅ‚ MiesiÄ™cy na Pasma SezonowoÅ›ci</h3>
        <div class="bands-summary" style="display:flex;gap:20px;margin-bottom:16px;flex-wrap:wrap">
          <div id="highMonthsList" class="band-months-box high">
            <div class="band-header">HIGH - Wysokie zuÅ¼ycie</div>
            <div class="band-months-list">-</div>
            <div class="band-consumption">-</div>
          </div>
          <div id="midMonthsList" class="band-months-box mid">
            <div class="band-header">MID - Åšrednie zuÅ¼ycie</div>
            <div class="band-months-list">-</div>
            <div class="band-consumption">-</div>
          </div>
          <div id="lowMonthsList" class="band-months-box low">
            <div class="band-header">LOW - Niskie zuÅ¼ycie</div>
            <div class="band-months-list">-</div>
            <div class="band-consumption">-</div>
          </div>
        </div>

        <!-- SzczegÃ³Å‚owa tabela miesiÄ™cy -->
        <div class="monthly-details-table" style="overflow-x:auto">
          <table id="monthlyBandsDetailTable" style="width:100%;border-collapse:collapse;font-size:13px">
            <thead>
              <tr style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white">
                <th style="padding:10px;text-align:left;border-radius:8px 0 0 0">MiesiÄ…c</th>
                <th style="padding:10px;text-align:center">Pasmo</th>
                <th style="padding:10px;text-align:right">ZuÅ¼ycie [MWh]</th>
                <th style="padding:10px;text-align:right">P95 Mocy [kW]</th>
                <th style="padding:10px;text-align:right">Åšr. Moc [kW]</th>
                <th style="padding:10px;text-align:right;border-radius:0 8px 0 0">% Rocznego</th>
              </tr>
            </thead>
            <tbody id="monthlyBandsTableBody">
              <!-- WypeÅ‚niane dynamicznie -->
            </tbody>
          </table>
        </div>

        <!-- Rekomendowane moce AC dla pasm -->
        <div id="recommendedPowers" class="recommended-powers-section" style="margin-top:20px;padding:16px;background:#f8f9fa;border-radius:8px">
          <h4 style="font-size:14px;color:#2c3e50;margin-bottom:12px">Rekomendowane Limity Mocy AC dla Optymalizacji PV</h4>
          <div class="powers-grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
            <div class="power-card high" style="padding:12px;border-radius:8px;text-align:center">
              <div style="font-size:11px;font-weight:600;text-transform:uppercase;opacity:0.8">HIGH</div>
              <div id="highPowerRecommended" style="font-size:24px;font-weight:700">- kW</div>
              <div style="font-size:10px;opacity:0.7">P95 z okresu HIGH</div>
            </div>
            <div class="power-card mid" style="padding:12px;border-radius:8px;text-align:center">
              <div style="font-size:11px;font-weight:600;text-transform:uppercase;opacity:0.8">MID</div>
              <div id="midPowerRecommended" style="font-size:24px;font-weight:700">- kW</div>
              <div style="font-size:10px;opacity:0.7">P95 z okresu MID</div>
            </div>
            <div class="power-card low" style="padding:12px;border-radius:8px;text-align:center">
              <div style="font-size:11px;font-weight:600;text-transform:uppercase;opacity:0.8">LOW</div>
              <div id="lowPowerRecommended" style="font-size:24px;font-weight:700">- kW</div>
              <div style="font-size:10px;opacity:0.7">P95 z okresu LOW</div>
            </div>
          </div>
          <div style="margin-top:12px;font-size:11px;color:#666;padding:8px;background:#e8f5e9;border-radius:4px;border-left:3px solid #4caf50">
            Te limity mocy AC sÄ… uÅ¼ywane w strategii <strong>PASMA SEZONOWOÅšÄ†</strong> do ograniczenia eksportu energii w okresach niskiego zapotrzebowania.
          </div>
        </div>
      </div>

      <canvas id="seasonalityChart" style="margin-top:20px"></canvas>
      <div id="seasonalityMessage" class="seasonality-message"></div>
    </div>

    <!-- Analiza rozkÅ‚adu mocy -->
    <div class="chart-section">
      <h2>Krzywa UporzÄ…dkowana Mocy</h2>
      <div class="chart-info">
        RozkÅ‚ad mocy od najwiÄ™kszej do najmniejszej
      </div>
      <canvas id="loadDurationCurve"></canvas>
    </div>

    <!-- Statystyki szczegÃ³Å‚owe -->
    <div class="details-section">
      <h2>Statystyki SzczegÃ³Å‚owe</h2>
      <div class="details-grid">
        <div class="detail-item">
          <span class="detail-label">Åšrednia Moc:</span>
          <span class="detail-value" id="avgPower">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Odchylenie Standardowe:</span>
          <span class="detail-value" id="stdDev">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">WspÃ³Å‚czynnik ZmiennoÅ›ci:</span>
          <span class="detail-value" id="variationCoef">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">WspÃ³Å‚czynnik ObciÄ…Å¼enia:</span>
          <span class="detail-value" id="loadFactor">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">IloÅ›Ä‡ PomiarÃ³w:</span>
          <span class="detail-value" id="dataPoints">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Okres Danych:</span>
          <span class="detail-value" id="dataPeriod">-</span>
        </div>
      </div>
    </div>

    <!-- Akcje -->
    <div class="actions-section full-width">
      <button class="btn" onclick="exportAnalysis()">ðŸ“¥ Eksportuj do Excel</button>
      <button class="btn btn-secondary" onclick="refreshData()">ðŸ”„ OdÅ›wieÅ¼ Dane</button>
    </div>
  </div>

  <!-- Info gdy brak danych -->
  <div id="noDataMessage" class="no-data">
    <div class="no-data-icon">ðŸ“Š</div>
    <h3>Brak Danych do Analizy</h3>
    <p>PrzejdÅº do moduÅ‚u Configuration i zaÅ‚aduj dane zuÅ¼ycia energii.</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="consumption.js?v=20251211-EXCEL-EXPORT"></script>
</body>
</html>
