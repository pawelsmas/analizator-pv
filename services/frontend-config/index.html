<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Configuration Module</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="module-container">
  <div class="sidebar">
    <div class="section-title">üìÅ WCZYTAJ DANE</div>
    <div class="file-input">
      <input type="file" id="loadFile" accept=".csv,.xlsx"/>
      <div>Wgraj dane zu≈ºycia</div>
      <div style="font-size:11px;color:#666;margin-top:4px">CSV lub XLSX</div>
    </div>
    <div id="loadStatus"></div>

    <div class="section-title" style="margin-top:24px">‚öôÔ∏è KONFIGURACJA PV</div>
    <label>Typ instalacji</label>
    <select id="pvType">
      <option value="ground_s">Grunt Po≈Çudnie</option>
      <option value="roof_ew">Dach Wsch√≥d-Zach√≥d</option>
      <option value="ground_ew">Grunt Wsch√≥d-Zach√≥d</option>
    </select>

    <!-- Settings from USTAWIENIA module - readonly display -->
    <div class="settings-display" style="margin-top:16px;padding:12px;background:#e8f5e9;border-radius:8px;border-left:3px solid #27ae60">
      <div style="font-size:11px;font-weight:600;color:#27ae60;margin-bottom:8px">üìä Z MODU≈ÅU USTAWIENIA</div>
      <div class="row">
        <div>
          <label style="font-size:10px">Uzysk [kWh/kWp/y]</label>
          <input type="number" id="yield" readonly style="background:#f5f5f5;font-weight:600">
        </div>
        <div>
          <label style="font-size:10px">DC/AC Ratio</label>
          <input type="number" id="dcac" readonly style="background:#f5f5f5;font-weight:600">
        </div>
      </div>
    </div>

    <div class="section-title" style="margin-top:24px">üîé ZAKRES ANALIZY</div>
    <div style="padding:12px;background:#e3f2fd;border-radius:8px;border-left:3px solid #2196f3">
      <div style="font-size:11px;font-weight:600;color:#1565c0;margin-bottom:8px">üìä Z MODU≈ÅU USTAWIENIA</div>
      <div class="row">
        <div>
          <label style="font-size:10px">Min [kWp]</label>
          <input type="number" id="capMin" readonly style="background:#f5f5f5;font-weight:600">
        </div>
        <div>
          <label style="font-size:10px">Max [kWp]</label>
          <input type="number" id="capMax" readonly style="background:#f5f5f5;font-weight:600">
        </div>
      </div>
      <label style="font-size:10px">Krok [kWp]</label>
      <input type="number" id="capStep" readonly style="background:#f5f5f5;font-weight:600">
    </div>

    <div class="section-title" style="margin-top:24px">üéØ STRATEGIA OPTYMALIZACJI</div>
    <label>Strategia</label>
    <select id="optimizationStrategy" onchange="toggleStrategyOptions()">
      <option value="autoconsumption">Autokonsumpcja (%)</option>
      <option value="npv">Maksymalizacja NPV</option>
      <option value="seasonality_auto">üå°Ô∏è PASMA SEZONOWO≈öƒÜ - Max Autokonsumpcja</option>
      <option value="seasonality_npv">üå°Ô∏è PASMA SEZONOWO≈öƒÜ - Max NPV</option>
    </select>

    <!-- Seasonality info (shown when seasonality strategy selected) -->
    <div id="seasonalityInfo" style="display:none;margin-top:12px">
      <div id="seasonalityDetected" style="padding:12px;background:#e8f5e9;border-radius:8px;border-left:3px solid #4caf50;display:none">
        <div style="font-size:11px;font-weight:600;color:#2e7d32;margin-bottom:8px">‚úÖ WYKRYTO SEZONOWO≈öƒÜ</div>
        <div id="seasonalityMessage" style="font-size:11px;color:#1b5e20"></div>
        <div style="margin-top:8px;font-size:10px;color:#388e3c">
          <span id="highMonthsCount">0</span> mies. High |
          <span id="midMonthsCount">0</span> mies. Mid |
          <span id="lowMonthsCount">0</span> mies. Low
        </div>
      </div>
      <div id="seasonalityNotDetected" style="padding:12px;background:#fff3e0;border-radius:8px;border-left:3px solid #ff9800;display:none">
        <div style="font-size:11px;font-weight:600;color:#e65100;margin-bottom:8px">‚ö†Ô∏è NIE WYKRYTO ZNACZƒÑCEJ SEZONOWO≈öCI</div>
        <div style="font-size:11px;color:#f57c00">Zu≈ºycie jest wzglƒôdnie stabilne. Strategia PASMA nadal mo≈ºe byƒá u≈ºyta, ale standardowa optymalizacja mo≈ºe byƒá r√≥wnie skuteczna.</div>
      </div>
      <div id="seasonalityLoading" style="padding:12px;background:#e3f2fd;border-radius:8px;border-left:3px solid #2196f3">
        <div style="font-size:11px;color:#1565c0">‚è≥ Wgraj dane aby sprawdziƒá sezonowo≈õƒá...</div>
      </div>
    </div>

    <!-- Season selector - ZAWSZE widoczny gdy strategia sezonowo≈õci wybrana -->
    <div id="seasonSelector" style="display:none;margin-top:12px;padding:12px;background:#f3e5f5;border-radius:8px;border-left:3px solid #9c27b0">
      <div style="font-size:11px;font-weight:600;color:#7b1fa2;margin-bottom:8px">üéØ OPTYMALIZUJ DLA SEZONU</div>
      <select id="targetSeason" style="width:100%;padding:8px;font-size:12px;border:1px solid #ce93d8;border-radius:4px;background:white">
        <option value="high">Tylko HIGH (wysokie zu≈ºycie)</option>
        <option value="high_mid" selected>HIGH + MID (wysokie i ≈õrednie)</option>
        <option value="all">Wszystkie sezony (High + Mid + Low)</option>
      </select>
      <div style="font-size:10px;color:#8e24aa;margin-top:6px">
        Wybierz dla kt√≥rych sezon√≥w optymalizowaƒá instalacjƒô PV
      </div>
    </div>

    <!-- Autoconsumption thresholds (shown when strategy = autoconsumption) -->
    <div id="autoconsumptionOptions">
      <div style="margin-top:12px;padding:12px;background:#fff3e0;border-radius:8px;border-left:3px solid #ff9800">
        <div style="font-size:11px;font-weight:600;color:#e65100;margin-bottom:8px">üìä PROGI Z MODU≈ÅU USTAWIENIA</div>
        <div class="row">
          <div>
            <label style="font-size:10px">A [%]</label>
            <input type="number" id="thrA" readonly style="background:#f5f5f5;font-weight:600;color:#27ae60">
          </div>
          <div>
            <label style="font-size:10px">B [%]</label>
            <input type="number" id="thrB" readonly style="background:#f5f5f5;font-weight:600;color:#3498db">
          </div>
        </div>
        <div class="row">
          <div>
            <label style="font-size:10px">C [%]</label>
            <input type="number" id="thrC" readonly style="background:#f5f5f5;font-weight:600;color:#f39c12">
          </div>
          <div>
            <label style="font-size:10px">D [%]</label>
            <input type="number" id="thrD" readonly style="background:#f5f5f5;font-weight:600;color:#e74c3c">
          </div>
        </div>
      </div>
    </div>

    <!-- NPV optimization options (shown when strategy = npv) -->
    <div id="npvOptions" style="display:none;margin-top:12px">
      <label>Tryb optymalizacji NPV</label>
      <select id="npvMode" style="margin-bottom:12px" onchange="updateNpvModeHint()">
        <option value="constrained">Najlepsze NPV w zakresie A-D%</option>
        <option value="absolute">Najlepsze NPV (ca≈Çy zakres mocy)</option>
      </select>

      <div style="padding:12px;background:#f3e5f5;border-radius:8px;border-left:3px solid #9c27b0">
        <div style="font-size:11px;font-weight:600;color:#7b1fa2;margin-bottom:8px">üìä PARAMETRY Z MODU≈ÅU USTAWIENIA</div>

        <label style="font-size:10px">Cena energii [PLN/MWh]</label>
        <input type="number" id="npvEnergyPrice" readonly style="background:#f5f5f5;font-weight:600">

        <label style="font-size:10px">OPEX [PLN/kWp/rok]</label>
        <input type="number" id="npvOpex" readonly style="background:#f5f5f5;font-weight:600">

        <label style="font-size:10px">Stopa dyskontowa [%]</label>
        <input type="number" id="npvDiscountRate" readonly style="background:#f5f5f5;font-weight:600">

        <label style="font-size:10px">Degradacja [%/rok]</label>
        <input type="number" id="npvDegradation" readonly style="background:#f5f5f5;font-weight:600">

        <label style="font-size:10px">Okres analizy [lat]</label>
        <input type="number" id="npvAnalysisPeriod" readonly style="background:#f5f5f5;font-weight:600">
      </div>

      <div style="margin-top:12px;padding:10px;background:#fff3e0;border-radius:6px;border-left:3px solid #ff9800">
        <div style="font-size:11px;font-weight:600;color:#e65100;margin-bottom:8px">üí∞ CAPEX Z MODU≈ÅU USTAWIENIA [PLN/kWp]</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:10px">
          <div style="display:flex;justify-content:space-between;padding:2px 4px;background:#fff">
            <span>150-500:</span>
            <span id="capexDisplay1" style="font-weight:600">4200</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:2px 4px;background:#fff">
            <span>501-1000:</span>
            <span id="capexDisplay2" style="font-weight:600">3800</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:2px 4px;background:#fff">
            <span>1001-2500:</span>
            <span id="capexDisplay3" style="font-weight:600">3500</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:2px 4px;background:#fff">
            <span>2501-5000:</span>
            <span id="capexDisplay4" style="font-weight:600">3200</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:2px 4px;background:#fff">
            <span>5001-10000:</span>
            <span id="capexDisplay5" style="font-weight:600">3000</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:2px 4px;background:#fff">
            <span>10001-15000:</span>
            <span id="capexDisplay6" style="font-weight:600">2850</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:2px 4px;background:#fff;grid-column:span 2">
            <span>15001-50000:</span>
            <span id="capexDisplay7" style="font-weight:600">2700</span>
          </div>
        </div>
      </div>

      <div id="npvModeHint" style="font-size:11px;color:#666;margin-top:8px;padding:8px;background:#f5f5f5;border-radius:4px">
        Optymalna instalacja zostanie dobrana w zakresie autokonsumpcji A-D% z uwzglƒôdnieniem przedzia≈Ç√≥w CAPEX
      </div>
    </div>

    <button class="btn" onclick="runAnalysis()">URUCHOM ANALIZƒò</button>
    <button class="btn btn-secondary" onclick="exportToExcel()">EKSPORT DO EXCEL</button>
    <button class="btn btn-secondary" onclick="exportAnalysisLogs()" style="background:linear-gradient(135deg,#9b59b6 0%,#8e44ad 100%)">üìã EKSPORT LOG√ìW</button>
    <button class="btn btn-danger" onclick="clearAllData()" style="background:linear-gradient(135deg,#e74c3c 0%,#c0392b 100%)">üóëÔ∏è WYCZY≈öƒÜ DANE</button>
  </div>

  <div class="content">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="statConsumption">‚Äì</div>
        <div class="stat-label">Roczne zu≈ºycie [GWh]</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statPeak">‚Äì</div>
        <div class="stat-label">Moc szczytowa [MW]</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statDays">‚Äì</div>
        <div class="stat-label">Okres danych [dni]</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statAvg">‚Äì</div>
        <div class="stat-label">≈ör. dzienne [MWh]</div>
      </div>
    </div>

    <div id="configResults">
      <p style="color:#666;text-align:center;margin-top:40px">
        Wgraj dane zu≈ºycia i uruchom analizƒô
      </p>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="config-v2.js?v=20251209-besspro"></script>
</body>
</html>
